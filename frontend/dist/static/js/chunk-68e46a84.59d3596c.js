(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-68e46a84","chunk-2d21ee4a"],{"28a5":function(e,t,n){"use strict";var s=n("aae3"),i=n("cb7c"),r=n("ebd6"),a=n("0390"),u=n("9def"),c=n("5f1b"),o=n("520a"),l=n("79e5"),f=Math.min,m=[].push,d="split",h="length",v="lastIndex",p=4294967295,g=!l((function(){RegExp(p,"y")}));n("214f")("split",2,(function(e,t,n,l){var b;return b="c"=="abbc"[d](/(b)*/)[1]||4!="test"[d](/(?:)/,-1)[h]||2!="ab"[d](/(?:ab)*/)[h]||4!="."[d](/(.?)(.?)/)[h]||"."[d](/()()/)[h]>1||""[d](/.?/)[h]?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!s(e))return n.call(i,e,t);var r,a,u,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,d=void 0===t?p:t>>>0,g=new RegExp(e.source,l+"g");while(r=o.call(g,i)){if(a=g[v],a>f&&(c.push(i.slice(f,r.index)),r[h]>1&&r.index<i[h]&&m.apply(c,r.slice(1)),u=r[0][h],f=a,c[h]>=d))break;g[v]===r.index&&g[v]++}return f===i[h]?!u&&g.test("")||c.push(""):c.push(i.slice(f)),c[h]>d?c.slice(0,d):c}:"0"[d](void 0,0)[h]?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,s){var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i,s):b.call(String(i),n,s)},function(e,t){var s=l(b,e,this,t,b!==n);if(s.done)return s.value;var o=i(e),m=String(this),d=r(o,RegExp),h=o.unicode,v=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(g?"y":"g"),k=new d(g?o:"^(?:"+o.source+")",v),_=void 0===t?p:t>>>0;if(0===_)return[];if(0===m.length)return null===c(k,m)?[m]:[];var y=0,x=0,C=[];while(x<m.length){k.lastIndex=g?x:0;var w,U=c(k,g?m:m.slice(x));if(null===U||(w=f(u(k.lastIndex+(g?0:x)),m.length))===y)x=a(m,x,h);else{if(C.push(m.slice(y,x)),C.length===_)return C;for(var I=1;I<=U.length-1;I++)if(C.push(U[I]),C.length===_)return C;x=y=w}}return C.push(m.slice(y)),C}]}))},"32f7":function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.item.name===e.name?n("div",{staticClass:"clearfix"},[n("div",{staticClass:"chat-content",staticStyle:{float:"right"}},[n("p",{staticClass:"title"},[e._v(e._s(e.item.name)+"  "+e._s(e.item.time))]),e._v(" "),n("p",{staticClass:"content"},[e._v(e._s(e.item.content))])])]):n("div",{staticClass:"clearfix"},[n("div",{staticClass:"chat-content",staticStyle:{float:"left"}},[n("p",{staticClass:"title"},[e._v(e._s(e.item.name)+"  "+e._s(e.item.time))]),e._v(" "),n("p",{staticClass:"content"},[e._v(e._s(e.item.content))])])])},i=[],r={name:"ChatItem",props:{item:{type:Object,default:{}},name:{type:String,default:""}}},a=r,u=(n("521a"),n("2877")),c=Object(u["a"])(a,s,i,!1,null,"4581f108",null);t["a"]=c.exports},3846:function(e,t,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"521a":function(e,t,n){"use strict";var s=n("e767"),i=n.n(s);i.a},"5d58":function(e,t,n){e.exports=n("d8d6")},"67bb":function(e,t,n){e.exports=n("f921")},"6b54":function(e,t,n){"use strict";n("3846");var s=n("cb7c"),i=n("0bfb"),r=n("9e1e"),a="toString",u=/./[a],c=function(e){n("2aba")(RegExp.prototype,a,e,!0)};n("79e5")((function(){return"/a/b"!=u.call({source:"a",flags:"b"})}))?c((function(){var e=s(this);return"/".concat(e.source,"/","flags"in e?e.flags:!r&&e instanceof RegExp?i.call(e):void 0)})):u.name!=a&&c((function(){return u.call(this)}))},"6d5b":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chat"}},[n("el-row",[n("el-col",{attrs:{span:16}},[e.kefu!==e.name||0===e.users.length?n("div",{staticClass:"chat-box"},e._l(e.messages,(function(t){return n("div",{key:t.timezone},[n("chat-item",{attrs:{item:t,name:e.name}})],1)})),0):e._e(),e._v(" "),e.kefu===e.name&&e.users.length>1?n("el-tabs",{staticStyle:{"margin-top":"20px"},attrs:{"tab-position":"left"},model:{value:e.currentUser,callback:function(t){e.currentUser=t},expression:"currentUser"}},e._l(e.users,(function(t){return e.kefu!==t?n("el-tab-pane",{key:t,attrs:{label:t,name:t}},[n("div",{staticClass:"chat-box"},e._l(e.kefuMsg[t],(function(s){return n("div",{key:t.timezone},[n("chat-item",{attrs:{item:s,name:e.name}})],1)})),0)]):e._e()})),1):n("div",{staticClass:"chat-box warnTips"},[n("h1",[e._v("暂时没有用户接入客服，请耐心等待")])])],1),e._v(" "),n("el-col",{attrs:{span:8}},[n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e.name!==e.kefu?n("span",[e._v("在线客服")]):e._e(),e._v(" "),e.name===e.kefu?n("span",[e._v("在线用户")]):e._e()]),e._v(" "),e.name!==e.kefu?n("div",{staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"text item"},[e._v("\n              "+e._s(e.kefu)+"\n            ")])]):e._e(),e._v(" "),e.name===e.kefu?n("div",{staticStyle:{"margin-bottom":"20px"}},e._l(e.users,(function(t){return n("span",{key:t},[t!==e.kefu?n("el-radio",{staticStyle:{"margin-right":"20px"},attrs:{label:t,border:""},on:{change:e.changeCurrentUser},model:{value:e.currentUser,callback:function(t){e.currentUser=t},expression:"currentUser"}},[e._v(e._s(t))]):e._e()],1)})),0):e._e(),e._v(" "),n("el-form",{staticClass:"chat-msg",attrs:{inline:!0,model:e.formInline},nativeOn:{submit:function(t){return t.preventDefault(),e.test(t)}}},[n("el-form-item",{attrs:{label:"消息"}},[n("el-input",{nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.send(t))}},model:{value:e.formInline.msg,callback:function(t){e.$set(e.formInline,"msg",t)},expression:"formInline.msg"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"success",plain:""},nativeOn:{click:function(t){return t.preventDefault(),e.send(t)}}},[e._v("发送")])],1)],1)],1),e._v(" "),n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("使用说明")])]),e._v(" "),n("p",{staticClass:"tips",staticStyle:{color:"#f50","line-height":"1.4"}},[e._v("\n            当前客服由前端直接模拟，默认是登录名为871228582@qq.com的用户。\n          ")]),e._v(" "),n("p",{staticClass:"tips",staticStyle:{color:"#f50","line-height":"1.4"}},[e._v("\n            可以查看api/chat下的getCustomer,实际中你可以根据自己的情况，从后台数据库配置中获取\n          ")]),e._v(" "),n("p",{staticClass:"tips",staticStyle:{color:"#f50","line-height":"1.4"}},[e._v("\n          要完整的查看演示效果，可以用多个浏览器分别使用不同的系统管理员登录，一个是871228582@qq.com，表示客服，另几个是其他的系统管理员（如test1和test2）。\n          ")])])],1)],1)],1)},i=[],r=(n("20d6"),n("7f7f"),n("db72")),a=n("d800"),u=n("2f62"),c=n("ed08"),o=n("32f7"),l={name:"chat_kefu",components:{ChatItem:o["a"]},data:function(){return{users:[],currentUser:"",formInline:{msg:""},kefu:"",messages:[],kefuMsg:{}}},computed:Object(r["a"])({},Object(u["b"])(["name"])),beforeRouteLeave:function(e,t,n){window.Echo.leave("kefu"),n()},beforeRouteEnter:function(e,t,n){n((function(e){Object(a["getCustomer"])().then((function(t){e.kefu=t.name})),window.Echo.join("kefu").here((function(t){e.users=t,e.users.length&&e.kefu===e.name&&e.$nextTick((function(){e.currentUser=e.users[e.users.length-1]}))})).joining((function(t){e.users.push(t),e.name===e.kefu&&(e.kefuMsg[t]||e.$set(e.kefuMsg,t,[]),e.$nextTick((function(){e.currentUser=e.users[e.users.length-1]})))})).leaving((function(t){var n=e.users.findIndex((function(e){return e===t}));e.users.splice(n,1),e.name===e.kefu&&(e.users[e.users.length-1]!==e.name?e.currentUser=e.users[e.users.length-1]:e.currentUser="")})).listen("CustomerService",(function(t){var n=t.msg;if(e.kefu!==e.name&&n.receiveName===e.name&&e.messages.push({name:n.sendName,time:n.time,timezone:n.timezone,content:n.content}),e.kefu===e.name){var s=n.sendName;e.kefuMsg[s]&&e.kefuMsg[s].push({name:n.sendName,time:n.time,timezone:n.timezone,content:n.content})}}))}))},created:function(){var e=this;document.onkeydown=function(t){if(void 0==window.event)var n=t.keyCode;else n=window.event.keyCode;13===n&&e.send()}},methods:{test:function(e){return!1},send:function(){if(!this.formInline.msg)return!1;if(this.name!==this.kefu){var e={sendName:this.name,receiveName:this.kefu,timezone:Date.now(),time:Object(c["a"])(Date.now()),content:this.formInline.msg};this.formInline.msg="",this.messages.push({name:e.sendName,time:e.time,timezone:e.timezone,content:e.content}),Object(a["sendKefu"])(e).then((function(){}))}if(this.name===this.kefu){var t={sendName:this.name,receiveName:this.currentUser,timezone:Date.now(),time:Object(c["a"])(Date.now()),content:this.formInline.msg};Array.isArray(this.kefuMsg[this.currentUser])||this.$set(this.kefuMsg,this.currentUser,[]),this.kefuMsg[this.currentUser].push({name:t.sendName,time:t.time,timezone:t.timezone,content:t.content}),this.formInline.msg="",Object(a["sendKefu"])(t).then((function(){}))}},changeCurrentUser:function(e){this.currentUser=e}}},f=l,m=(n("e190"),n("2877")),d=Object(m["a"])(f,s,i,!1,null,"eac69d88",null);t["default"]=d.exports},7618:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var s=n("5d58"),i=n.n(s),r=n("67bb"),a=n.n(r);function u(e){return u="function"===typeof a.a&&"symbol"===typeof i.a?function(e){return typeof e}:function(e){return e&&"function"===typeof a.a&&e.constructor===a.a&&e!==a.a.prototype?"symbol":typeof e},u(e)}},b456:function(e,t,n){},d800:function(e,t,n){"use strict";n.r(t),n.d(t,"sendChat",(function(){return i})),n.d(t,"getCustomer",(function(){return r})),n.d(t,"sendKefu",(function(){return a}));var s=n("1c1e");function i(e){return Object(s["a"])({url:"/api/chat",method:"post",data:e})}function r(){return new Promise((function(e,t){var n={name:"wmhello"};e(n)}))}function a(e){return Object(s["a"])({url:"/api/kefu",method:"post",data:e})}},e190:function(e,t,n){"use strict";var s=n("b456"),i=n.n(s);i.a},e767:function(e,t,n){},ed08:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("28a5"),n("a481"),n("6b54");var s=n("7618");function i(e,t){if(0===arguments.length)return null;var n,i=t||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(s["a"])(e)?n=e:("string"===typeof e&&/^[0-9]+$/.test(e)&&(e=parseInt(e)),"number"===typeof e&&10===e.toString().length&&(e*=1e3),n=new Date(e));var r={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()},a=i.replace(/{(y|m|d|h|i|s|a)+}/g,(function(e,t){var n=r[t];return"a"===t?["日","一","二","三","四","五","六"][n]:(e.length>0&&n<10&&(n="0"+n),n||0)}));return a}}}]);